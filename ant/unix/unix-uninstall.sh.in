#!/bin/bash

# Halt on first error
set -e

if [ "$(id -u)" != "0" ]; then
   echo "This script must be run with root (sudo) privileges" 1>&2
   exit 1
fi

# Get working directory
DIR=$(cd "$(dirname "$0")" && pwd)
pushd "$DIR"

echo "Running uninstall tasks..."
if [[ "$OSTYPE" == "darwin"* ]]; then
    "$DIR/../MacOS/${project.name}" uninstall
    ROOT_DIR=$(cd "$(dirname "$0")/../.." && pwd)
    if [[ "$ROOT_DIR" != *".app" ]]; then
      echo -e "\nMalformed app directory. Uninstallation of ${project.name} failed.\n"
      exit 1
    fi

else
    "$DIR/${project.filename}" uninstall
    ROOT_DIR="$DIR"
fi

echo "Deleting files..."
rm -rf "$ROOT_DIR"
echo -e "\nUninstall of ${project.name} complete.\n"

popd &>/dev/null